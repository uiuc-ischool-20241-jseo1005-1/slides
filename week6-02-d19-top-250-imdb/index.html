<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Scraping top 250 movies on IMDB</title>
    <meta charset="utf-8" />
    <meta name="author" content="JooYoung Seo" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/tone/Tone.js"></script>
    <script src="libs/slide-tone/slide-tone.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <script src="libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="../xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="../slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Scraping top 250 movies on IMDB
]
.subtitle[
## IS 407
]
.author[
### JooYoung Seo
]

---








class: middle

# Top 250 movies on IMDB

---

## Top 250 movies on IMDB

Take a look at the source code, look for the tag `table` tag:
&lt;br&gt;
http://www.imdb.com/chart/top

.pull-left[
&lt;img src="img/imdb-top-250.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="img/imdb-top-250-source.png" width="94%" style="display: block; margin: auto;" /&gt;
]


---

## First check if you're allowed!


```r
library(robotstxt)
paths_allowed("http://www.imdb.com")
```

```
## [1] TRUE
```

vs. e.g.


```r
paths_allowed("http://www.facebook.com")
```

```
## [1] FALSE
```

---

## Plan

&lt;img src="img/plan.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Plan

1. Read the whole page

2. Scrape movie titles and save as `titles` 

3. Scrape years movies were made in and save as `years`

4. Scrape IMDB ratings and save as `ratings`

5. Create a data frame called `imdb_top_250` with variables `title`, `year`, and `rating`

---

class: middle

# Step 1. Read the whole page

---

## Read the whole page


```r
page &lt;- read_html("https://www.imdb.com/chart/top/")
page
```

```
## {html_document}
## &lt;html lang="en-US" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml"&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html ...
## [2] &lt;body&gt;\n&lt;div&gt;    &lt;img height="1" width="1" style="display: ...
```

---

## A webpage in R

- Result is a list with 2 elements


```r
typeof(page)
```

```
## [1] "list"
```

--

- that we need to convert to something more familiar, like a data frame....


```r
class(page)
```

```
## [1] "xml_document" "xml_node"
```

---

class: middle

# Step 2. Scrape movie titles and save as `titles` 

---

## Scrape movie titles

&lt;img src="img/titles.png" width="70%" style="display: block; margin: auto;" /&gt;

---

## Scrape the nodes

.pull-left[

```r
page %&gt;%
  html_nodes("a.ipc-title-link-wrapper")
```

```
## {xml_nodeset (257)}
##  [1] &lt;a href="/title/tt0111161/?ref_=chttp_t_1" class="ipc-tit ...
##  [2] &lt;a href="/title/tt0068646/?ref_=chttp_t_2" class="ipc-tit ...
##  [3] &lt;a href="/title/tt0468569/?ref_=chttp_t_3" class="ipc-tit ...
##  [4] &lt;a href="/title/tt0071562/?ref_=chttp_t_4" class="ipc-tit ...
##  [5] &lt;a href="/title/tt0050083/?ref_=chttp_t_5" class="ipc-tit ...
##  [6] &lt;a href="/title/tt0108052/?ref_=chttp_t_6" class="ipc-tit ...
##  [7] &lt;a href="/title/tt0167260/?ref_=chttp_t_7" class="ipc-tit ...
##  [8] &lt;a href="/title/tt0110912/?ref_=chttp_t_8" class="ipc-tit ...
##  [9] &lt;a href="/title/tt0120737/?ref_=chttp_t_9" class="ipc-tit ...
## [10] &lt;a href="/title/tt0060196/?ref_=chttp_t_10" class="ipc-ti ...
## [11] &lt;a href="/title/tt0109830/?ref_=chttp_t_11" class="ipc-ti ...
## [12] &lt;a href="/title/tt0167261/?ref_=chttp_t_12" class="ipc-ti ...
## [13] &lt;a href="/title/tt0137523/?ref_=chttp_t_13" class="ipc-ti ...
## [14] &lt;a href="/title/tt1375666/?ref_=chttp_t_14" class="ipc-ti ...
## [15] &lt;a href="/title/tt0080684/?ref_=chttp_t_15" class="ipc-ti ...
## [16] &lt;a href="/title/tt0133093/?ref_=chttp_t_16" class="ipc-ti ...
...
```
]
.pull-right[
&lt;img src="img/titles.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Extract the text from the nodes

.pull-left[

```r
page %&gt;%
  html_nodes("a.ipc-title-link-wrapper") %&gt;%
  html_text()
```

```
##   [1] "1. The Shawshank Redemption"                                             
##   [2] "2. The Godfather"                                                        
##   [3] "3. The Dark Knight"                                                      
##   [4] "4. The Godfather Part II"                                                
##   [5] "5. 12 Angry Men"                                                         
##   [6] "6. Schindler's List"                                                     
##   [7] "7. The Lord of the Rings: The Return of the King"                        
##   [8] "8. Pulp Fiction"                                                         
##   [9] "9. The Lord of the Rings: The Fellowship of the Ring"                    
##  [10] "10. The Good, the Bad and the Ugly"                                      
##  [11] "11. Forrest Gump"                                                        
##  [12] "12. The Lord of the Rings: The Two Towers"                               
##  [13] "13. Fight Club"                                                          
##  [14] "14. Inception"                                                           
##  [15] "15. Star Wars: Episode V - The Empire Strikes Back"                      
##  [16] "16. The Matrix"                                                          
...
```
]
.pull-right[
&lt;img src="img/titles.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Save as `titles`

.pull-left[

```r
titles &lt;- page %&gt;%
  html_nodes("a.ipc-title-link-wrapper") %&gt;%
  html_text()
titles &lt;- titles[1:250] %&gt;%
  stringr::str_remove("^\\d+\\.\\s")


titles
```

```
##   [1] "The Shawshank Redemption"                                            
##   [2] "The Godfather"                                                       
##   [3] "The Dark Knight"                                                     
##   [4] "The Godfather Part II"                                               
##   [5] "12 Angry Men"                                                        
##   [6] "Schindler's List"                                                    
##   [7] "The Lord of the Rings: The Return of the King"                       
##   [8] "Pulp Fiction"                                                        
##   [9] "The Lord of the Rings: The Fellowship of the Ring"                   
##  [10] "The Good, the Bad and the Ugly"                                      
##  [11] "Forrest Gump"                                                        
##  [12] "The Lord of the Rings: The Two Towers"                               
##  [13] "Fight Club"                                                          
##  [14] "Inception"                                                           
...
```
]
.pull-right[
&lt;img src="img/titles.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

class: middle

# Step 3. Scrape year movies were made and save as `years`

---

## Scrape years movies were made in

&lt;img src="img/years.png" width="70%" style="display: block; margin: auto;" /&gt;

---

## Scrape the nodes

.pull-left[

```r
page %&gt;%
  html_nodes("div &gt; .cli-title-metadata-item:first-child")
```

```
## {xml_nodeset (250)}
##  [1] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [2] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [3] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [4] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [5] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [6] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [7] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [8] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
##  [9] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [10] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [11] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [12] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [13] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [14] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [15] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
## [16] &lt;span class="sc-be6f1408-8 fcCUPU cli-title-metadata-item ...
...
```
]
.pull-right[
&lt;img src="img/years.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Extract the text from the nodes

.pull-left[

```r
page %&gt;%
  html_nodes("div &gt; .cli-title-metadata-item:first-child") %&gt;%
  html_text()
```

```
##   [1] "1994" "1972" "2008" "1974" "1957" "1993" "2003" "1994"
##   [9] "2001" "1966" "1994" "2002" "1999" "2010" "1980" "1999"
##  [17] "1990" "1975" "1995" "1946" "2014" "1954" "1991" "1998"
##  [25] "2002" "1997" "1999" "1991" "1977" "1985" "2001" "2023"
##  [33] "2002" "2019" "1960" "2000" "1994" "1994" "2006" "1998"
##  [41] "2014" "2006" "1988" "1962" "1995" "1942" "2011" "1936"
##  [49] "1988" "1954" "1968" "2023" "1979" "1931" "1979" "2012"
##  [57] "2000" "2008" "1981" "2006" "1950" "1957" "2018" "2018"
##  [65] "1980" "1957" "1940" "1986" "2009" "2012" "1964" "1999"
##  [73] "2003" "2017" "1984" "1995" "1981" "1995" "2019" "2019"
##  [81] "1997" "1997" "2023" "2016" "1984" "1963" "2009" "1952"
##  [89] "2018" "2000" "1985" "2010" "1983" "2004" "2012" "2023"
##  [97] "1968" "1992" "1952" "1962" "1960" "1941" "1959" "1931"
## [105] "1958" "1944" "1983" "2010" "2001" "1987" "1971" "1995"
## [113] "2009" "1962" "1973" "2011" "1989" "1988" "2020" "1927"
## [121] "2007" "2000" "1997" "1948" "2019" "1976" "2004" "2016"
...
```
]
.pull-right[
&lt;img src="img/years.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Convert to numeric


```r
page %&gt;%
  html_nodes("div &gt; .cli-title-metadata-item:first-child") %&gt;%
  html_text() %&gt;%
  str_remove("\\)") %&gt;% # remove )
  as.numeric()
```

```
##   [1] 1994 1972 2008 1974 1957 1993 2003 1994 2001 1966 1994 2002
##  [13] 1999 2010 1980 1999 1990 1975 1995 1946 2014 1954 1991 1998
##  [25] 2002 1997 1999 1991 1977 1985 2001 2023 2002 2019 1960 2000
##  [37] 1994 1994 2006 1998 2014 2006 1988 1962 1995 1942 2011 1936
##  [49] 1988 1954 1968 2023 1979 1931 1979 2012 2000 2008 1981 2006
##  [61] 1950 1957 2018 2018 1980 1957 1940 1986 2009 2012 1964 1999
##  [73] 2003 2017 1984 1995 1981 1995 2019 2019 1997 1997 2023 2016
##  [85] 1984 1963 2009 1952 2018 2000 1985 2010 1983 2004 2012 2023
##  [97] 1968 1992 1952 1962 1960 1941 1959 1931 1958 1944 1983 2010
## [109] 2001 1987 1971 1995 2009 1962 1973 2011 1989 1988 2020 1927
## [121] 2007 2000 1997 1948 2019 1976 2004 2016 1965 2005 1959 2013
## [133] 1921 2018 2020 2022 1961 1950 1998 2007 2010 1995 1985 1993
## [145] 1999 2006 1992 2001 2007 1948 1982 1961 2003 1975 1963 2003
...
```

---

## Save as `years`

.pull-left[

```r
years &lt;- page %&gt;%
  html_nodes("div &gt; .cli-title-metadata-item:first-child") %&gt;%
  html_text() %&gt;%
  as.numeric()

years
```

```
##   [1] 1994 1972 2008 1974 1957 1993 2003 1994 2001 1966 1994 2002
##  [13] 1999 2010 1980 1999 1990 1975 1995 1946 2014 1954 1991 1998
##  [25] 2002 1997 1999 1991 1977 1985 2001 2023 2002 2019 1960 2000
##  [37] 1994 1994 2006 1998 2014 2006 1988 1962 1995 1942 2011 1936
##  [49] 1988 1954 1968 2023 1979 1931 1979 2012 2000 2008 1981 2006
##  [61] 1950 1957 2018 2018 1980 1957 1940 1986 2009 2012 1964 1999
##  [73] 2003 2017 1984 1995 1981 1995 2019 2019 1997 1997 2023 2016
##  [85] 1984 1963 2009 1952 2018 2000 1985 2010 1983 2004 2012 2023
##  [97] 1968 1992 1952 1962 1960 1941 1959 1931 1958 1944 1983 2010
## [109] 2001 1987 1971 1995 2009 1962 1973 2011 1989 1988 2020 1927
## [121] 2007 2000 1997 1948 2019 1976 2004 2016 1965 2005 1959 2013
...
```
]
.pull-right[
&lt;img src="img/years.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

class: middle

# Step 4. Scrape IMDB ratings and save as `ratings`

---

## Scrape IMDB ratings

&lt;img src="img/ratings.png" width="70%" style="display: block; margin: auto;" /&gt;

---

## Scrape the nodes

.pull-left[

```r
page %&gt;%
  html_nodes(".ipc-rating-star.ipc-rating-star--base.ipc-rating-star--imdb.ratingGroup--imdb-rating")
```

```
## {xml_nodeset (250)}
##  [1] &lt;span aria-label="IMDb rating: 9.3" class="ipc-rating-sta ...
##  [2] &lt;span aria-label="IMDb rating: 9.2" class="ipc-rating-sta ...
##  [3] &lt;span aria-label="IMDb rating: 9.0" class="ipc-rating-sta ...
##  [4] &lt;span aria-label="IMDb rating: 9.0" class="ipc-rating-sta ...
##  [5] &lt;span aria-label="IMDb rating: 9.0" class="ipc-rating-sta ...
##  [6] &lt;span aria-label="IMDb rating: 9.0" class="ipc-rating-sta ...
##  [7] &lt;span aria-label="IMDb rating: 9.0" class="ipc-rating-sta ...
##  [8] &lt;span aria-label="IMDb rating: 8.9" class="ipc-rating-sta ...
##  [9] &lt;span aria-label="IMDb rating: 8.9" class="ipc-rating-sta ...
## [10] &lt;span aria-label="IMDb rating: 8.8" class="ipc-rating-sta ...
## [11] &lt;span aria-label="IMDb rating: 8.8" class="ipc-rating-sta ...
## [12] &lt;span aria-label="IMDb rating: 8.8" class="ipc-rating-sta ...
## [13] &lt;span aria-label="IMDb rating: 8.8" class="ipc-rating-sta ...
## [14] &lt;span aria-label="IMDb rating: 8.8" class="ipc-rating-sta ...
## [15] &lt;span aria-label="IMDb rating: 8.7" class="ipc-rating-sta ...
## [16] &lt;span aria-label="IMDb rating: 8.7" class="ipc-rating-sta ...
...
```
]
.pull-right[
&lt;img src="img/ratings.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Extract the text from the nodes

.pull-left[

```r
page %&gt;%
  html_nodes(".ipc-rating-star.ipc-rating-star--base.ipc-rating-star--imdb.ratingGroup--imdb-rating") %&gt;%
  html_text()
```

```
##   [1] "9.3 (2.9M)" "9.2 (2M)"   "9.0 (2.8M)" "9.0 (1.4M)"
##   [5] "9.0 (855K)" "9.0 (1.4M)" "9.0 (2M)"   "8.9 (2.2M)"
##   [9] "8.9 (2M)"   "8.8 (804K)" "8.8 (2.2M)" "8.8 (1.8M)"
##  [13] "8.8 (2.3M)" "8.8 (2.5M)" "8.7 (1.4M)" "8.7 (2M)"  
##  [17] "8.7 (1.2M)" "8.7 (1.1M)" "8.6 (1.8M)" "8.6 (496K)"
##  [21] "8.7 (2.1M)" "8.6 (364K)" "8.6 (1.5M)" "8.6 (1.5M)"
##  [25] "8.6 (795K)" "8.6 (737K)" "8.6 (1.4M)" "8.6 (1.2M)"
##  [29] "8.6 (1.4M)" "8.5 (1.3M)" "8.6 (838K)" "8.6 (348K)"
##  [33] "8.5 (902K)" "8.5 (938K)" "8.5 (713K)" "8.5 (1.6M)"
##  [37] "8.5 (1.1M)" "8.5 (1.2M)" "8.5 (1.4M)" "8.5 (1.2M)"
##  [41] "8.5 (972K)" "8.5 (1.4M)" "8.5 (306K)" "8.6 (67K)" 
##  [45] "8.5 (1.1M)" "8.5 (602K)" "8.5 (920K)" "8.5 (257K)"
##  [49] "8.5 (280K)" "8.5 (518K)" "8.5 (347K)" "9.1 (98K)" 
##  [53] "8.5 (941K)" "8.5 (195K)" "8.4 (704K)" "8.5 (1.7M)"
##  [57] "8.4 (1.3M)" "8.4 (1.2M)" "8.4 (1M)"   "8.4 (408K)"
##  [61] "8.4 (235K)" "8.4 (211K)" "8.4 (1.2M)" "8.4 (660K)"
...
```
]
.pull-right[
&lt;img src="img/ratings.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Convert to numeric

.pull-left[

```r
page %&gt;%
  html_nodes(".ipc-rating-star.ipc-rating-star--base.ipc-rating-star--imdb.ratingGroup--imdb-rating") %&gt;%
  html_text() %&gt;%
  stringr::str_extract(".+(?=\\s)") %&gt;%
  as.numeric()
```

```
##   [1] 9.3 9.2 9.0 9.0 9.0 9.0 9.0 8.9 8.9 8.8 8.8 8.8 8.8 8.8 8.7
##  [16] 8.7 8.7 8.7 8.6 8.6 8.7 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.5
##  [31] 8.6 8.6 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.6 8.5
##  [46] 8.5 8.5 8.5 8.5 8.5 8.5 9.1 8.5 8.5 8.4 8.5 8.4 8.4 8.4 8.4
##  [61] 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.3 8.3 8.4 8.4
##  [76] 8.3 8.4 8.3 8.4 8.4 8.3 8.3 8.4 8.4 8.3 8.4 8.4 8.3 8.4 8.3
##  [91] 8.4 8.3 8.3 8.3 8.3 8.4 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3
## [106] 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.2 8.2 8.3 8.3
## [121] 8.3 8.2 8.2 8.3 8.2 8.2 8.2 8.3 8.2 8.2 8.2 8.2 8.2 8.2 8.2
## [136] 8.3 8.3 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2
## [151] 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.1 8.1 8.2 8.2 8.2 8.1
## [166] 8.2 8.1 8.1 8.1 8.1 8.1 8.2 8.1 8.1 8.2 8.3 8.1 8.1 8.1 8.1
## [181] 8.1 8.2 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1
## [196] 8.1 8.1 8.1 8.1 8.1 8.2 8.1 8.1 8.2 8.1 8.1 8.1 8.1 8.1 8.1
## [211] 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.7 8.1 8.1
...
```
]
.pull-right[
&lt;img src="img/ratings.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Save as `ratings`

.pull-left[

```r
ratings &lt;- page %&gt;%
  html_nodes(".ipc-rating-star.ipc-rating-star--base.ipc-rating-star--imdb.ratingGroup--imdb-rating") %&gt;%
  html_text() %&gt;%
  stringr::str_extract(".+(?=\\s)") %&gt;%
  as.numeric()

ratings
```

```
##   [1] 9.3 9.2 9.0 9.0 9.0 9.0 9.0 8.9 8.9 8.8 8.8 8.8 8.8 8.8 8.7
##  [16] 8.7 8.7 8.7 8.6 8.6 8.7 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.5
##  [31] 8.6 8.6 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.6 8.5
##  [46] 8.5 8.5 8.5 8.5 8.5 8.5 9.1 8.5 8.5 8.4 8.5 8.4 8.4 8.4 8.4
##  [61] 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.3 8.3 8.4 8.4
##  [76] 8.3 8.4 8.3 8.4 8.4 8.3 8.3 8.4 8.4 8.3 8.4 8.4 8.3 8.4 8.3
##  [91] 8.4 8.3 8.3 8.3 8.3 8.4 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3
## [106] 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.2 8.2 8.3 8.3
## [121] 8.3 8.2 8.2 8.3 8.2 8.2 8.2 8.3 8.2 8.2 8.2 8.2 8.2 8.2 8.2
## [136] 8.3 8.3 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2
## [151] 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.1 8.1 8.2 8.2 8.2 8.1
## [166] 8.2 8.1 8.1 8.1 8.1 8.1 8.2 8.1 8.1 8.2 8.3 8.1 8.1 8.1 8.1
...
```
]
.pull-right[
&lt;img src="img/ratings.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

class: middle

# Step 5. Create a data frame called `imdb_top_250`

---

## Create a data frame: `imdb_top_250`


```r
imdb_top_250 &lt;- tibble(
  title = titles,
  year = years,
  rating = ratings
)

imdb_top_250
```

```
## # A tibble: 250 x 3
##   title                     year rating
##   &lt;chr&gt;                    &lt;dbl&gt;  &lt;dbl&gt;
## 1 The Shawshank Redemption  1994    9.3
## 2 The Godfather             1972    9.2
## 3 The Dark Knight           2008    9  
## 4 The Godfather Part II     1974    9  
## 5 12 Angry Men              1957    9  
## 6 Schindler's List          1993    9  
## # i 244 more rows
```

---

<div id="htmlwidget-8f836166d559454ecd73" style="width:100%;height:400px;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8f836166d559454ecd73">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250"],["The Shawshank Redemption","The Godfather","The Dark Knight","The Godfather Part II","12 Angry Men","Schindler's List","The Lord of the Rings: The Return of the King","Pulp Fiction","The Lord of the Rings: The Fellowship of the Ring","The Good, the Bad and the Ugly","Forrest Gump","The Lord of the Rings: The Two Towers","Fight Club","Inception","Star Wars: Episode V - The Empire Strikes Back","The Matrix","Goodfellas","One Flew Over the Cuckoo's Nest","Se7en","It's a Wonderful Life","Interstellar","Seven Samurai","The Silence of the Lambs","Saving Private Ryan","City of God","Life Is Beautiful","The Green Mile","Terminator 2: Judgment Day","Star Wars: Episode IV - A New Hope","Back to the Future","Spirited Away","Spider-Man: Across the Spider-Verse","The Pianist","Parasite","Psycho","Gladiator","The Lion King","Léon: The Professional","The Departed","American History X","Whiplash","The Prestige","Grave of the Fireflies","Harakiri","The Usual Suspects","Casablanca","The Intouchables","Modern Times","Cinema Paradiso","Rear Window","Once Upon a Time in the West","12th Fail","Alien","City Lights","Apocalypse Now","Django Unchained","Memento","WALL·E","Raiders of the Lost Ark","The Lives of Others","Sunset Blvd.","Paths of Glory","Avengers: Infinity War","Spider-Man: Into the Spider-Verse","The Shining","Witness for the Prosecution","The Great Dictator","Aliens","Inglourious Basterds","The Dark Knight Rises","Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb","American Beauty","Oldboy","Coco","Amadeus","Toy Story","The Boat","Braveheart","Avengers: Endgame","Joker","Princess Mononoke","Good Will Hunting","Oppenheimer","Your Name.","Once Upon a Time in America","High and Low","3 Idiots","Singin' in the Rain","Capernaum","Requiem for a Dream","Come and See","Toy Story 3","Star Wars: Episode VI - Return of the Jedi","Eternal Sunshine of the Spotless Mind","The Hunt","Poor Things","2001: A Space Odyssey","Reservoir Dogs","Ikiru","Lawrence of Arabia","The Apartment","Citizen Kane","North by Northwest","M","Vertigo","Double Indemnity","Scarface","Incendies","Amélie","Full Metal Jacket","A Clockwork Orange","Heat","Up","To Kill a Mockingbird","The Sting","A Separation","Indiana Jones and the Last Crusade","Die Hard","Hamilton","Metropolis","Like Stars on Earth","Snatch","L.A. Confidential","Bicycle Thieves","1917","Taxi Driver","Downfall","Dangal","For a Few Dollars More","Batman Begins","Some Like It Hot","The Wolf of Wall Street","The Kid","Green Book","The Father","Top Gun: Maverick","Judgment at Nuremberg","All About Eve","The Truman Show","There Will Be Blood","Shutter Island","Casino","Ran","Jurassic Park","The Sixth Sense","Pan's Labyrinth","Unforgiven","A Beautiful Mind","No Country for Old Men","The Treasure of the Sierra Madre","The Thing","Yojimbo","Kill Bill: Vol. 1","Monty Python and the Holy Grail","The Great Escape","Finding Nemo","Rashomon","The Elephant Man","Howl's Moving Castle","Prisoners","Chinatown","Dial M for Murder","Gone with the Wind","V for Vendetta","Lock, Stock and Two Smoking Barrels","The Secret in Their Eyes","Raging Bull","Inside Out","Three Billboards Outside Ebbing, Missouri","Trainspotting","The Bridge on the River Kwai","Spider-Man: No Way Home","Fargo","Warrior","Klaus","Godzilla Minus One","Catch Me If You Can","Gran Torino","My Neighbor Totoro","Million Dollar Baby","Harry Potter and the Deathly Hallows: Part 2","Children of Heaven","12 Years a Slave","Blade Runner","Before Sunrise","The Grand Budapest Hotel","Ben-Hur","Barry Lyndon","Gone Girl","The Gold Rush","Hacksaw Ridge","In the Name of the Father","Memories of Murder","On the Waterfront","Dead Poets Society","The General","The Deer Hunter","Wild Tales","Mad Max: Fury Road","Monsters, Inc.","Sherlock Jr.","Wild Strawberries","The Third Man","The Wages of Fear","Jaws","How to Train Your Dragon","Mary and Max","Mr. Smith Goes to Washington","Ford v Ferrari","Ratatouille","The Seventh Seal","Room","The Big Lebowski","Tokyo Story","Rocky","Logan","Spotlight","Hotel Rwanda","Platoon","The Terminator","The Passion of Joan of Arc","Before Sunset","Jai Bhim","The Best Years of Our Lives","La haine","The Exorcist","Rush","Network","Pirates of the Caribbean: The Curse of the Black Pearl","Stand by Me","The Wizard of Oz","The Incredibles","Into the Wild","Hachi: A Dog's Tale","The Handmaiden","My Father and My Son","To Be or Not to Be","The Sound of Music","The Grapes of Wrath","The Battle of Algiers","Groundhog Day","Amores Perros","Rebecca","Cool Hand Luke","The Iron Giant","The Help","It Happened One Night","The 400 Blows","Aladdin","Dances with Wolves"],[1994,1972,2008,1974,1957,1993,2003,1994,2001,1966,1994,2002,1999,2010,1980,1999,1990,1975,1995,1946,2014,1954,1991,1998,2002,1997,1999,1991,1977,1985,2001,2023,2002,2019,1960,2000,1994,1994,2006,1998,2014,2006,1988,1962,1995,1942,2011,1936,1988,1954,1968,2023,1979,1931,1979,2012,2000,2008,1981,2006,1950,1957,2018,2018,1980,1957,1940,1986,2009,2012,1964,1999,2003,2017,1984,1995,1981,1995,2019,2019,1997,1997,2023,2016,1984,1963,2009,1952,2018,2000,1985,2010,1983,2004,2012,2023,1968,1992,1952,1962,1960,1941,1959,1931,1958,1944,1983,2010,2001,1987,1971,1995,2009,1962,1973,2011,1989,1988,2020,1927,2007,2000,1997,1948,2019,1976,2004,2016,1965,2005,1959,2013,1921,2018,2020,2022,1961,1950,1998,2007,2010,1995,1985,1993,1999,2006,1992,2001,2007,1948,1982,1961,2003,1975,1963,2003,1950,1980,2004,2013,1974,1954,1939,2005,1998,2009,1980,2015,2017,1996,1957,2021,1996,2011,2019,2023,2002,2008,1988,2004,2011,1997,2013,1982,1995,2014,1959,1975,2014,1925,2016,1993,2003,1954,1989,1926,1978,2014,2015,2001,1924,1957,1949,1953,1975,2010,2009,1939,2019,2007,1957,2015,1998,1953,1976,2017,2015,2004,1986,1984,1928,2004,2021,1946,1995,1973,2013,1976,2003,1986,1939,2004,2007,2009,2016,2005,1942,1965,1940,1966,1993,2000,1940,1967,1999,2011,1934,1959,1992,1990],[9.300000000000001,9.199999999999999,9,9,9,9,9,8.9,8.9,8.800000000000001,8.800000000000001,8.800000000000001,8.800000000000001,8.800000000000001,8.699999999999999,8.699999999999999,8.699999999999999,8.699999999999999,8.6,8.6,8.699999999999999,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.5,8.6,8.6,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.5,8.6,8.5,8.5,8.5,8.5,8.5,8.5,8.5,9.1,8.5,8.5,8.4,8.5,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.4,8.300000000000001,8.300000000000001,8.4,8.4,8.300000000000001,8.4,8.300000000000001,8.4,8.4,8.300000000000001,8.300000000000001,8.4,8.4,8.300000000000001,8.4,8.4,8.300000000000001,8.4,8.300000000000001,8.4,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.4,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.300000000000001,8.199999999999999,8.199999999999999,8.300000000000001,8.300000000000001,8.300000000000001,8.199999999999999,8.199999999999999,8.300000000000001,8.199999999999999,8.199999999999999,8.199999999999999,8.300000000000001,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.300000000000001,8.300000000000001,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.199999999999999,8.1,8.1,8.199999999999999,8.199999999999999,8.199999999999999,8.1,8.199999999999999,8.1,8.1,8.1,8.1,8.1,8.199999999999999,8.1,8.1,8.199999999999999,8.300000000000001,8.1,8.1,8.1,8.1,8.1,8.199999999999999,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.199999999999999,8.1,8.1,8.199999999999999,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.699999999999999,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8,8.1,8.1,8.1,8.199999999999999,8.1,8.1,8.1,8.1,8,8.1,8.1,8.1,8.1,8.1,8.1,8.1,8,8]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>title<\/th>\n      <th>year<\/th>\n      <th>rating<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"p","pageLength":8,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"title","targets":1},{"name":"year","targets":2},{"name":"rating","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

## Clean up / enhance

May or may not be a lot of work depending on how messy the data are

- See if you like what you got:


```r
glimpse(imdb_top_250)
```

```
## Rows: 250
## Columns: 3
## $ title  &lt;chr&gt; "The Shawshank Redemption", "The Godfather", "Th~
## $ year   &lt;dbl&gt; 1994, 1972, 2008, 1974, 1957, 1993, 2003, 1994, ~
## $ rating &lt;dbl&gt; 9.3, 9.2, 9.0, 9.0, 9.0, 9.0, 9.0, 8.9, 8.9, 8.8~
```

- Add a variable for rank

```r
imdb_top_250 &lt;- imdb_top_250 %&gt;%
  mutate(rank = 1:nrow(imdb_top_250)) %&gt;%
  relocate(rank)
```

---


```
## # A tibble: 250 x 4
##     rank title                                        year rating
##    &lt;int&gt; &lt;chr&gt;                                       &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 The Shawshank Redemption                     1994    9.3
##  2     2 The Godfather                                1972    9.2
##  3     3 The Dark Knight                              2008    9  
##  4     4 The Godfather Part II                        1974    9  
##  5     5 12 Angry Men                                 1957    9  
##  6     6 Schindler's List                             1993    9  
##  7     7 The Lord of the Rings: The Return of the K~  2003    9  
##  8     8 Pulp Fiction                                 1994    8.9
##  9     9 The Lord of the Rings: The Fellowship of t~  2001    8.9
## 10    10 The Good, the Bad and the Ugly               1966    8.8
## 11    11 Forrest Gump                                 1994    8.8
## 12    12 The Lord of the Rings: The Two Towers        2002    8.8
## 13    13 Fight Club                                   1999    8.8
## 14    14 Inception                                    2010    8.8
## 15    15 Star Wars: Episode V - The Empire Strikes ~  1980    8.7
## 16    16 The Matrix                                   1999    8.7
## 17    17 Goodfellas                                   1990    8.7
## 18    18 One Flew Over the Cuckoo's Nest              1975    8.7
## 19    19 Se7en                                        1995    8.6
## 20    20 It's a Wonderful Life                        1946    8.6
## # i 230 more rows
```

---

class: middle

# What next?

---

.question[
Which years have the most movies on the list?
]

--


```r
imdb_top_250 %&gt;%
  count(year, sort = TRUE)
```

```
## # A tibble: 86 x 2
##    year     n
##   &lt;dbl&gt; &lt;int&gt;
## 1  1995     8
## 2  2004     7
## 3  1957     6
## 4  1999     6
## 5  2003     6
## 6  2009     6
## # i 80 more rows
```

---

.question[
Which 1995 movies made the list?
]

--


```r
imdb_top_250 %&gt;%
  filter(year == 1995) %&gt;%
  print(n = 8)
```

```
## # A tibble: 8 x 4
##    rank title               year rating
##   &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;
## 1    19 Se7en               1995    8.6
## 2    45 The Usual Suspects  1995    8.5
## 3    76 Toy Story           1995    8.3
## 4    78 Braveheart          1995    8.3
## 5   112 Heat                1995    8.3
## 6   142 Casino              1995    8.2
## 7   185 Before Sunrise      1995    8.1
## 8   225 La haine            1995    8.1
```

---

.question[
Visualize the average yearly rating for movies that made it on the top 250 list over time.
]

--

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-41-1.png" width="58%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]


```r
imdb_top_250 %&gt;%
  group_by(year) %&gt;%
  summarise(avg_score = mean(rating)) %&gt;%
  ggplot(aes(y = avg_score, x = year)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Year", y = "Average score")
```
]
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
